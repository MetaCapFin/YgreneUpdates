<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat with TuCielo</title>
  <link rel="stylesheet" href="/chat-widget.css" />
  <style>
    html, body {
      height: 100%;
    }

    .back-to-main {
      padding: 10px 20px;
      background-color: #BFD400;
      color: #303C42;
      border: none;
      cursor: pointer;
      font-family: 'Mulish', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0;
      margin-top: 20px;
      align-self: center;
    }
  </style>
</head>
<body>
  <div id="chat-widget-container">
    <div class="chat-header">Chatbot</div>
    <div class="chat-messages" id="chat-messages"></div>
    <form class="chat-input-area" id="chat-form">
      <input
        type="text"
        id="chat-input"
        class="chat-input"
        placeholder="Say something..."
        required
      />
      <button type="submit" class="chat-submit">Send</button>
    </form>
    <button class="back-to-main" onclick="window.location.href='/'">
      ← Back to Main Page
    </button>
  </div>

  <script>
    const form = document.getElementById("chat-form");
    const input = document.getElementById("chat-input");
    const messages = document.getElementById("chat-messages");

    let userName = null;

    const appendMessage = (text, sender) => {
      const msg = document.createElement("div");
      msg.className = `chat-message ${sender}`;
      msg.innerText = text;
      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
    };

    // Show initial welcome message
    appendMessage(
      "Hello! and welcome to V.Y.P.-Chatbot lounge! I use generative AI to help you better understand Ygrene and Ygrene's product.\n\nYou are our Very Ygrene Person — what is your name?",
      "bot"
    );

    form.onsubmit = (e) => {
      e.preventDefault();
      const userInput = input.value.trim();
      if (!userInput) return;

      appendMessage(userInput, "user");
      input.value = "";

      if (!userName) {
        userName = userInput;
        appendMessage(`Nice to meet you, ${userName}! How can I help you today?`, "bot");
        return;
      }

      // Simple example logic
      const lower = userInput.toLowerCase();
      let response = `Thanks for your message, ${userName}. I'm here to help with anything related to Ygrene!`;

      if (lower.includes("ygrene")) {
        response = "Ygrene provides PACE financing for energy-efficient and storm-resilient home improvements.";
      } else if (lower.includes("apply")) {
        response = `You can apply through Ygrene’s website. Would you like me to guide you through the process, ${userName}?`;
      }

      appendMessage(response, "bot");
    };
  </script>
</body>
</html>
