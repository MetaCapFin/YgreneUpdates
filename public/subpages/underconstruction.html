<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat with Ygrene</title>
  <link rel="stylesheet" href="/chat-widget.css" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    .back-to-main {
      padding: 10px 20px;
      background-color: #BFD400;
      color: #303C42;
      border: none;
      cursor: pointer;
      font-family: 'Mulish', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0;
      margin-top: 20px;
      align-self: center;
    }

    /* Bot message fade-in */
    .fade-in-bot {
      opacity: 0;
      animation: fadeInBot 1s ease forwards;
    }

    @keyframes fadeInBot {
      to {
        opacity: 1;
      }
    }

    /* User message slide up + fade-in */
    .slide-fade-in-user {
      opacity: 0;
      transform: translateY(20px);
      animation: slideFadeInUser 0.4s ease forwards;
    }

    @keyframes slideFadeInUser {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Add some spacing and scroll behavior */
    #chat-messages {
      max-height: 400px;
      overflow-y: auto;
      padding: 10px;
    }

    .chat-message {
      margin: 6px 0;
      padding: 8px 12px;
      border-radius: 10px;
      max-width: 80%;
      font-family: 'Mulish', sans-serif;
    }

    .chat-message.user {
      align-self: flex-end;
      background-color: #BFD400;
      color: #303C42;
    }

    .chat-message.bot {
      align-self: flex-start;
      background-color: #f1f1f1;
      color: #000;
    }

    #chat-widget-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-width: 600px;
      margin: 0 auto;
    }

    .chat-header {
      padding: 16px;
      background-color: #303C42;
      color: white;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
    }

    .chat-input-area {
      display: flex;
      padding: 10px;
      border-top: 1px solid #ccc;
    }

    .chat-input {
      flex: 1;
      padding: 10px;
      font-size: 16px;
    }

    .chat-submit {
      background-color: #BFD400;
      border: none;
      padding: 10px 16px;
      font-family: 'Mulish', sans-serif;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div id="chat-widget-container">
    <div class="chat-header">VYP-Chatbot</div>
    <div class="chat-messages" id="chat-messages"></div>
    <form class="chat-input-area" id="chat-form">
      <input
        type="text"
        id="chat-input"
        class="chat-input"
        placeholder="Say something..."
        required
      />
      <button type="submit" class="chat-submit">Send</button>
    </form>
    <button class="back-to-main" onclick="window.location.href='/'">
      ‚Üê Back to Main Page
    </button>
  </div>

  <script>
    const form = document.getElementById("chat-form");
    const input = document.getElementById("chat-input");
    const messages = document.getElementById("chat-messages");

    let userName = null;
    let awaitingHelpConfirmation = false;

    const appendMessage = (text, sender) => {
      const msg = document.createElement("div");
      msg.className = `chat-message ${sender}`;

      if (sender === "bot") {
        msg.classList.add("fade-in-bot");
      } else if (sender === "user") {
        msg.classList.add("slide-fade-in-user");
      }

      msg.innerText = text;
      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
    };

    window.addEventListener("DOMContentLoaded", () => {
      setTimeout(() => {
        appendMessage(
          "Hello! and welcome to V.Y.P.-Chatbot lounge! I use generative AI to help you better understand Ygrene and Ygrene's product.\n\nYou are our Very Ygrene Person ‚Äî what is your name?",
          "bot"
        );
      }, 1000);
    });

    form.onsubmit = (e) => {
      e.preventDefault();
      const userInput = input.value.trim();
      if (!userInput) return;

      appendMessage(userInput, "user");
      input.value = "";

      if (!userName) {
        userName = userInput;
        appendMessage(`Nice to meet you, ${userName}! How can I help you today?`, "bot");
        return;
      }

      if (awaitingHelpConfirmation) {
        const lowerInput = userInput.toLowerCase();
        if (["yes", "sure", "okay", "please", "yeah", "yep"].some(word => lowerInput.includes(word))) {
          appendMessage(
            `Here‚Äôs how you can get in touch:\n\nYgreneVIP Support:\nüìû Phone: XXX XXX XXXX\nüìß Email: support@ygrene.vip\n\nRM: C.A.\nüìß Email: c.a.@ygrene.vip\nüìû Phone: XXX XXX XXXX`,
            "bot"
          );
          appendMessage(`You can also schedule a one-on-one via the QR code below:`, "bot");

          const qrImage = document.createElement("img");
          qrImage.src = "https://your-calendly-qr-link.png";
          qrImage.alt = "Schedule with RM";
          qrImage.style.width = "120px";
          qrImage.style.margin = "10px 0";
          messages.appendChild(qrImage);
          messages.scrollTop = messages.scrollHeight;

          awaitingHelpConfirmation = false;
        } else {
          appendMessage(`No problem! I'm still here if you want to try again later.`, "bot");
          awaitingHelpConfirmation = false;
        }
        return;
      }

      const lower = userInput.toLowerCase();
      let response = null;

      if (lower.includes("what is ygrene") || lower.includes("who is ygrene")) {
        response = "Ygrene provides PACE financing for energy-efficient and storm-resilient home improvements. Would you like to know what types of projects are eligible?";
      } else if (lower.includes("how do i apply") || lower.includes("apply")) {
        response = `You can apply through Ygrene‚Äôs website. Would you like me to guide you through the process, ${userName}?`;
      } else if (
        lower.includes("eligible") ||
        lower.includes("projects") ||
        lower.includes("improvements")
      ) {
        response = "Eligible projects typically include solar panels, roofing, HVAC, impact windows, and more. Would you like the full list?";
      }

      if (response) {
        appendMessage(response, "bot");
      } else {
        appendMessage(
          `I'm not sure I can answer that right now, ${userName}. Would you like me to help you connect with a Support Agent or your Relationship Manager?`,
          "bot"
        );
        awaitingHelpConfirmation = true;
      }
    };
  </script>
</body>
</html>



